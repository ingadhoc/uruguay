<?xml version='1.0' encoding='utf-8'?>
<odoo>

    <record id="view_move_form" model="ir.ui.view">
        <field name="name">account.move.form</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">

            <sheet position="before">
                <div class="alert alert-danger" role="alert" style="margin-bottom:0px;" attrs="{'invisible': ['|', '|', ('l10n_uy_journal_type', 'not in', ['electronic', 'contingency']), ('state', '!=', 'posted'), ('l10n_uy_cfe_pdf', '!=', False)]}"><bold>Esta factura esta validada pero le falta el PDF legal asociado, por favor intente re generarlo</bold>
                    <button name="action_l10n_uy_get_pdf" type="object" string="(UY) Reprint Legal PDF" class="oe_inline oe_link" attrs="{
                    'invisible': ['|', ('l10n_uy_cfe_state', 'not in', ['received', 'accepted', 'rejected']), ('invoice_filter_type_domain', '=', 'purchase')]}" icon="fa-print"/>
                </div>
                <div class="alert alert-warning" role="alert" style="margin-bottom:0px;" attrs="{'invisible': ['|', '|', ('l10n_uy_journal_type', 'not in', ['electronic', 'contingency']), ('state', '!=', 'draft'), ('l10n_uy_cfe_pdf', '!=', False)]}"><bold>Esta factura aun no esta validada, asi que si intenta imprimir tendra un PDF no Legal</bold></div>
            </sheet>

            <div name="journal_div" position="after">
                <field name="l10n_uy_journal_type" invisible="1"/>
                <field name="l10n_uy_cfe_pdf" invisible="1"/>
                <field name="l10n_uy_cfe_state" attrs="{'invisible': [('l10n_uy_journal_type', 'not in', ['electronic', 'contingency'])]}"/>
                <field name="l10n_uy_ucfe_msg" attrs="{'invisible': [('l10n_uy_ucfe_state', 'not in', ['xml_error', 'connection_error', 'ucfe_error', 'rejected'])]}"/>
                <button name="action_l10n_uy_get_dgi_state" type="object" string="(UY) Consult DGI State" class="oe_inline oe_link" attrs="{'invisible': [('l10n_uy_cfe_state', '!=', 'received')]}" icon="fa-refresh" colspan="2" groups="base.group_no_one"/>
            </div>

            <group id="header_left_group">
                <field name="l10n_uy_additional_info" attrs="{'invisible': [('l10n_uy_journal_type', 'not in', ['electronic', 'contingency'])]}"/>
            </group>
            <!-- TODO need to find a way to hide computed_currency_rate field, this one is added in l10n_ar_ux, so.. maybe we should add it in another base
            ux module. to be re used. Meanwhile we do not show l10n_uy_currency_rate -->
            <!--  <div name="currency" position="inside">
                <field name="l10n_uy_currency_rate" attrs="{'invisible': ['|', '|', ('l10n_uy_currency_rate', '=', False), ('l10n_uy_currency_rate', '=', 0.0), ('l10n_uy_currency_rate', '=', 1.0)]}"/>
            </div> -->

            <field name="invoice_incoterm_id" position="after">
                <field name="l10n_uy_cfe_sale_mod"/>
                <field name="l10n_uy_cfe_transport_route"/>
            </field>

            <notebook position="inside">
                <page name="uy_dgi" string="DGI" attrs="{'invisible': [('l10n_uy_journal_type', 'not in', ['electronic', 'contingency'])]}">
                            <notebook>
                                <page string="Detail">
                                    <group string="UCFE" attrs="{'invisible': [('invoice_filter_type_domain', '=', 'purchase')]}">
                                        <field name="l10n_uy_cfe_uuid"/>
                                        <button name="action_l10n_uy_get_uruware_cfe" type="object" string="Get Uruware Invoice" class="oe_link" colspan="2"/>
                                    </group>
                                    <group>
                                        <field name="l10n_uy_ucfe_state"/>
                                        <field name="l10n_uy_ucfe_msg"/>
                                        <field name="l10n_uy_idreq" attrs="{'invisible': [('invoice_filter_type_domain', '!=', 'purchase')]}"/>
                                        <field name="l10n_uy_cfe_file"/>
                                    </group>
                                    <group string="DGI">
                                        <field name="l10n_uy_dgi_barcode"/>
                                    </group>
                                </page>
                                <page string="XML CFE" groups="base.group_no_one">
                                    <span attrs="{'invisible': [('invoice_filter_type_domain', '=', 'purchase')]}">
                                        <button name="action_l10n_uy_preview_xml" type="object" string="Preview" class="oe_inline oe_link" states="draft"/>
                                        <button name="action_l10n_uy_validate_cfe" type="object" string="Validate" class="oe_inline oe_link" states="draft"/>
                                    </span>
                                    <div attrs="{'invisible': [('invoice_filter_type_domain', '!=', 'purchase')]}">
                                        <button name="action_l10n_uy_update_fields" type="object" string="Update Fields" class="oe_inline oe_link" states="draft" help="Read the XML and fill the fields of the invoice/bill with the xml values" confirm="Are you sure? this action will update the invoice information."/>
                                    </div>
                                    <field name="l10n_uy_cfe_xml" nolabel="1" widget="ace"/>
                                </page>
                                <page string="XML Request" groups="base.group_no_one">
                                    <field name="l10n_uy_dgi_xml_request" nolabel="1" widget="ace"/>
                                </page>
                                <page string="XML Response" groups="base.group_no_one">
                                    <field name="l10n_uy_dgi_xml_response" nolabel="1" widget="ace"/>
                                </page>
                            </notebook>
                </page>
            </notebook>
        </field>
    </record>

    <record id="view_invoice_tree" model="ir.ui.view">
        <field name="name">account.move.view.tree</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_invoice_tree"/>
        <field name="arch" type="xml">
            <tree>
                <field name="l10n_uy_cfe_state" optional="hide"/>
            </tree>
        </field>
    </record>

    <record id="view_account_invoice_filter" model="ir.ui.view">
        <field name="name">account.move.view.search</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_account_invoice_filter"/>
        <field name="arch" type="xml">
            <search>
                <field name="l10n_uy_cfe_state"/>
            </search>
            <group>
                <filter string="CFE State" name="cfe_state" context="{'group_by':'l10n_uy_cfe_state'}"/>
            </group>

        </field>
    </record>

</odoo>
